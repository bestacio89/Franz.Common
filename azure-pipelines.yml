trigger:
- Develop

pool:
  vmImage: 'windows-latest'

variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'

steps:
# ----------------------------------------
# ðŸ”§ Install .NET 10 SDK
# ----------------------------------------
- task: UseDotNet@2
  displayName: 'Install .NET 10 SDK'
  inputs:
    packageType: 'sdk'
    version: '10.0.x'
    includePreviewVersions: true

# ----------------------------------------
# ðŸ“¦ Install NuGet
# ----------------------------------------
- task: NuGetToolInstaller@1
  displayName: 'Install NuGet'

# ----------------------------------------
# ðŸ” Authenticate to Azure Artifacts
# ----------------------------------------
- task: NuGetAuthenticate@1
  displayName: 'Authenticate to Azure Artifacts'

# ----------------------------------------
# ðŸ“¥ Restore Packages
# ----------------------------------------
- task: NuGetCommand@2
  displayName: 'Restore NuGet Packages'
  inputs:
    restoreSolution: '$(solution)'
    feedsToUse: 'select'
    vstsFeed: 'AjnaTellus/FranzArtifact'

# ----------------------------------------
# ðŸ—ï¸ Build Solution
# ----------------------------------------
- task: VSBuild@1
  displayName: 'Build Solution (.NET 10)'
  inputs:
    solution: '$(solution)'
    msbuildArgs: >
      /p:SkipInvalidConfigurations=true
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'

# ----------------------------------------
# ðŸ§ª Run Tests
# ----------------------------------------
- task: VSTest@2
  displayName: 'Run Tests'
  inputs:
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'
    diagnosticsEnabled: true
    codeCoverageEnabled: true

# ----------------------------------------
# ðŸ“¦ Publish NuGet Packages (all frameworks)
# ----------------------------------------
- task: NuGetCommand@2
  displayName: 'Publish NuGet Packages to Azure Artifacts'
  inputs:
    command: 'push'
    packagesToPush: '$(Build.SourcesDirectory)/**/*.nupkg'
    publishVstsFeed: 'AjnaTellus/FranzArtifact'
    allowPackageConflicts: true
